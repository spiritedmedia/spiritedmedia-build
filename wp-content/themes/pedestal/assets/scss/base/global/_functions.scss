// ==========================================================================
// Pedestal // Base // Global // FUNCTIONS
// ==========================================================================


@import 'functions-type-checking';


//
// Units
// ==========================================================================


/**
 * Math helpers.
 *
 * Halve and double numbers, E.G.:
 *
 * .foo {
 *     padding: halve( $base-spacing-unit );
 * }
 */
@function quarter( $number ) {
  @return $number / 4;
}

@function halve( $number ) {
  @return $number / 2;
}

@function double( $number ) {
  @return $number * 2;
}

@function quadruple( $number ) {
  @return $number * 4;
}


/// Clamp `$number` between `$min` and `$max`
///
/// @link https://css-tricks.com/snippets/sass/clamping-number/
///
/// @param {Number} $number - Number to clamp
/// @param {Number} $min - Minimum value
/// @param {Number} $max - Maximum value
/// @return {Number}
@function clamp($number, $min, $max) {
  @return min(max($number, $min), $max);
}


/**
 * Convert a value to the specified unit
 *
 * The unit's value is arbitrary - it could be 1px or 2000px - this function
 * just gets the unit from that.
 *
 * @param  {unit} $value The value to convert
 * @param  {unit} $unit  The output unit
 * @return {unit}
 */
@function convert-to-unit( $value, $unit ) {
  @return strip-unit( $value ) * ( $unit - $unit + 1 );
}





/**
 * Convert each value in a map of units or numbers to rems
 *
 * @param  {map} $map Map where each value is a unit or number
 * @return {map}
 */
@function rem-calc-map-values( $map ) {
  $new-map: ();
  @each $key, $value in $map {
    @if ( number == type-of( $value ) ) {
      $new-map: map-merge( $new-map, ( $key: rem-calc( $value ) ) );
    }
  }
  @return $new-map;
}





//
// Colors
// ==========================================================================


/// Calculate text color with sufficient contrast against a given background color
///
/// @param  {color} $bg - $primary-color - Background color
/// @param  {color} $text-light - $white
/// @param  {color} $text-dark - $body-font-color
/// @param  {percent} $threshold - Lightness threshold
@function text-contrast(
  $bg: $primary-color,
  $text-light: $white,
  $text-dark: $body-font-color,
  $threshold: 65%
) {
  @return if( lightness( $bg ) > $threshold, $text-dark, $text-light );
}





//
// Maps
// ==========================================================================


/**
 * `map-get()` with error checking
 *
 * @param  {map}    $map
 * @param  {string} $key
 * @return {mixed}
 */
@function map-get-strict( $map, $key ) {
  @if map-has-key( $map, $key ) {
    @return map-get( $map, $key );
  } @else {
    @error 'ERROR: Specified index `#{$key}` does not exist in the map `#{$map}`!';
  }
}


/**
 * Get value from nested map
 *
 * @author Hugo Giraudel
 *
 * @param  {map}     $map
 * @param  {arglist} $keys key chain
 * @return {*}             Desired value
 */
@function map-fetch( $map, $keys... ) {
  @each $key in $keys {
    $map: map-get-strict( $map, $key );
  }
  @return $map;
}


/// Get the prescribed width of an icon
///
/// IcoMoon generates specific em widths for each icon we use.
///
/// @param {string} $icon Icon name
/// @return {unit}        Icon width in ems
@function icon-width-get( $icon ) {
  @return map-get-strict( $icon-widths, $icon );
}





//
// Strings
// ==========================================================================


/**
 * Replace `$search` with `$replace` in `$string`
 *
 * @author Hugo Giraudel
 *
 * http://sassmeister.com/gist/1b4f2da5527830088e4d
 *
 * @param {string}  $string         Initial string
 * @param {string}  $search         Substring to replace
 * @param {string}  $replace ( '' ) New value
 * @return {string}                 Updated string
 */
@function str-replace( $string, $search, $replace: '' ) {
  $index: str-index( $string, $search );

  @if $index {
    @return str-slice( $string, 1, $index - 1 ) + $replace + str-replace( str-slice( $string, $index + str-length( $search ) ), $search, $replace );
  }

  @return $string;
}





// ==========================================================================
// Spirited Media Config Data
// ==========================================================================


/**
 * Get a map of the rem dimensions for image sizes
 *
 * @param  {string} $size Optional name of a WP image size to get dimension map
 * @return {map}
 */
@function sm-pedestal-img-sizes-get( $size: null ) {
  $new-sizes: ();

  @if ( $size != null and string == type-of( $size ) ) {
    $dimensions: map-fetch( $spiritedmedia-pedestal, imageSizes, $size );
    @return rem-calc-map-values( $dimensions );
  } @else {
    $sizes: map-fetch( $spiritedmedia-pedestal, imageSizes );
    @each $size, $dimensions in $sizes {
      $new-dims: rem-calc-map-values( $dimensions );
      $new-sizes: map-merge( $new-sizes, ( $size: $new-dims ) );
    }
    @return $new-sizes;
  }
}
