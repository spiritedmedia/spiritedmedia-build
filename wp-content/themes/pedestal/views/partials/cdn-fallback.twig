<script>
    (function(window, document, ga){
        function changeElems( tagName, attr, newHostName ) {
            var elems = document.getElementsByTagName(tagName);
            for ( var i = 0; i<elems.length; i++ ) {
                var elem = elems[i];
                var attrVal = elem.getAttribute(attr);
                if ( attrVal ) {
                    // Replace a.spirited.media with the current domain
                    var newAttrVal = attrVal.replace(/a\.spirited\.media/ig, newHostName);
                    if ( attrVal !== newAttrVal ) {
                        elem.setAttribute(attr, newAttrVal);
                    }
                }
            }
        }

        // If the <body> doesn't have the font-family set to Overpass or Merriweather,
        // then we can assume the stylesheet failed to download
        if (
            -1 === window.getComputedStyle(document.body).getPropertyValue('font-family').indexOf('Overpass')
            && -1 === window.getComputedStyle(document.body).getPropertyValue('font-family').indexOf('Merriweather')
        ) {
            var newHostName = window.location.host;
            var newImgHostName = 'd9nsjsuh3e2lm.cloudfront.net';
            changeElems( 'link', 'href', newHostName);
            changeElems( 'img', 'srcset', newImgHostName );
            changeElems( 'img', 'src', newImgHostName );
            changeElems( 'script', 'src', newHostName );

            // Ensure Google Analytics is available
            if ( typeof ga === 'function' ) {
                ga('send', 'event', 'Error', '', 'CDN failed to load');
            }
        }
    })(window, document, ga);
</script>
