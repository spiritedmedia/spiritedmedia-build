{% set cluster = false %}
{% if item.is_entity and item.has_story %}
    {% set cluster = item.get_primary_story() %}
{% endif %}

{% if cluster %}
    {% set fail_help_text = 'Trouble subscribing to ' ~ cluster.get_the_title %}
<form method="POST" action="{{ site.url }}/subscribe-to-email-list/"
    id="get-updates"
    class="c-get-updates"
    data-ga-category="Submitted Form"
    data-ga-label="Follow Cluster|{{ cluster.get_type_name }}|{{ cluster.get_the_title }}">
    <hr class="c-get-updates__accent">

    <label class="c-get-updates__label" for="get-updates-email">We&rsquo;ll send you important developments about <strong class="c-get-updates__cluster-title">{{ cluster.get_the_title }}</strong> as they happen.</label>
    <input type="hidden" name="cluster-id" value="{{ cluster.get_id }}" />
    {% include 'partials/email-forms/form-honeypot.twig' %}

    <input type="email" name="email_address" class="c-get-updates__email" id="get-updates-email" value="{{ current_user.get_email_address() }}" placeholder="{{ site.emails.placeholder }}" required>
    <button class="js-form-submit c-get-updates__submit" type="submit" name="Follow">
        <span>Follow This</span>
    </button>

    <div class="c-get-updates__loader">{% include 'partials/loading.twig' %}</div>

    <div class="c-get-updates__success-message">
        <hr class="c-get-updates__accent">
        <h3>Please check your email to confirm your subscription to &ldquo;{{ cluster.get_the_title }}&rdquo;</h3>
        <p>You'll get emails from {{ site.name }} as this {{ cluster.get_type_name|lower }} develops. You can unsubscribe in every email.</p>
    </div>

    <div class="c-get-updates__fail-message">
        <hr class="c-get-updates__accent">
        <h3>Oops! Something went wrong.</h3>
        <p><a href="mailto:{{ site.emails.contact }}?subject={{ fail_help_text|url_encode }}">Having trouble? Email {{ site.emails.contact }}</a></p>
    </div>
</form>
{% endif %}
